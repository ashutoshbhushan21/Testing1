=TRIM(MID(A1, MIN(SEARCH({"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"}, A1&"ABCDEFGHIJKLMNOPQRSTUVWXYZ"), 27), LEN(A1)))


soup = BeautifulSoup(html, 'html.parser')

def find_deepest_tr_with_text(element, target_text):
    result = None
    
    def dfs(current_element, current_depth):
        nonlocal result
        if current_element.name == 'tr' and target_text in current_element.get_text():
            if result is None or current_depth > result[1]:
                result = (current_element, current_depth)
        
        for child in current_element.children:
            if child and child.name:
                dfs(child, current_depth + 1)
    
    dfs(element, 0)
    
    return result[0] if result else None

target_text = "XYZ"
deepest_tr = find_deepest_tr_with_text(soup, target_text)

if deepest_tr:
    print("Deepest <tr> tag containing", target_text, ":", deepest_tr)
else:
    print("No <tr> tag containing", target_text, "found.")







from bs4 import BeautifulSoup, NavigableString

def find_deepest_tag_and_tr_with_text(html, target_text):
    soup = BeautifulSoup(html, 'html.parser')

    deepest_tag_result = None
    deepest_tr_result = None

    def dfs(current_element, current_depth):
        nonlocal deepest_tag_result, deepest_tr_result

        if target_text in current_element.get_text():
            if isinstance(current_element, NavigableString):
                current_tag = current_element.parent
            else:
                current_tag = current_element

            if deepest_tag_result is None or current_depth > deepest_tag_result[1]:
                deepest_tag_result = (current_tag, current_depth)

            tr_ancestor = current_tag.find_parent('tr')
            if tr_ancestor and (deepest_tr_result is None or current_depth > deepest_tr_result[1]):
                deepest_tr_result = (tr_ancestor, current_depth)

        for child in current_element.children:
            if child and hasattr(child, 'name'):
                dfs(child, current_depth + 1)

    dfs(soup, 0)

    return (deepest_tag_result[0] if deepest_tag_result else None,
            deepest_tr_result[0] if deepest_tr_result else None)
